<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spinny Blaster 9</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: #020617;
      color: #e5e7eb;
      font-family: system-ui, -apple-system, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 12px;
      min-height: 100vh;
      gap: 8px;
    }
    h1 { font-size: 24px; text-align: center; }
    h2 { font-size: 13px; text-align: center; color: #9ca3af; }

    #gameWrapper {
      background: #020617;
      border-radius: 12px;
      padding: 8px;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      max-width: 480px;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    canvas {
      background: #020617;
      border-radius: 8px;
      width: 100%;
      height: auto;
      image-rendering: pixelated;
      border: 1px solid #111827;
      touch-action: none;
    }

    #hud {
      width: 100%;
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: #9ca3af;
    }

    #touchControls {
      width: 100%;
      max-width: 480px;
      display: none;
      justify-content: space-between;
      margin-top: 10px;
      user-select: none;
    }

    .joystick {
      width: 110px;
      height: 110px;
      border-radius: 50%;
      background: #111827;
      border: 2px solid #4b5563;
      position: relative;
      touch-action: none;
    }

    .stick {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: #22c55e;
      position: absolute;
      left: 32px;
      top: 32px;
    }

    .fireBtn {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: #f97316;
      border: 2px solid #4b5563;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 18px;
      touch-action: none;
    }
  </style>
</head>
<body>
  <h1>Spinny Blaster 9</h1>
  <h2>Buns Games for stupid peopel</h2>

  <div id="gameWrapper">
    <canvas id="game" width="320" height="180"></canvas>
    <div id="hud">
      <span id="status">WASD / Arrows to move, mouse to aim, click to shoot</span>
      <span id="score">Score: 0</span>
    </div>
  </div>

  <!-- TOUCH CONTROLS -->
  <div id="touchControls">
    <div id="leftJoy" class="joystick">
      <div class="stick" id="leftStick"></div>
    </div>
    <div id="fireBtn" class="fireBtn">FIRE</div>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const statusEl = document.getElementById("status");
    const scoreEl = document.getElementById("score");
    const touchControls = document.getElementById("touchControls");

    /* AUTO-DETECT TOUCHSCREEN */
    const isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
    if (isTouch) {
      touchControls.style.display = "flex";
      statusEl.textContent = "Touch joystick to move, tap FIRE to shoot";
    }

    /* KEYBOARD DETECTION */
    document.addEventListener("keydown", () => {
      if (!isTouch) return;
      touchControls.style.display = "none";
    });

    document.addEventListener("touchstart", () => {
      if (isTouch) touchControls.style.display = "flex";
    });

    /* INPUT */
    const keys = { left: false, right: false, up: false, down: false };
    let mouse = { x: canvas.width / 2, y: canvas.height / 2, down: false };

    document.addEventListener("keydown", e => {
      if (e.key === "ArrowLeft" || e.key === "a") keys.left = true;
      if (e.key === "ArrowRight" || e.key === "d") keys.right = true;
      if (e.key === "ArrowUp" || e.key === "w") keys.up = true;
      if (e.key === "ArrowDown" || e.key === "s") keys.down = true;
    });
    document.addEventListener("keyup", e => {
      if (e.key === "ArrowLeft" || e.key === "a") keys.left = false;
      if (e.key === "ArrowRight" || e.key === "d") keys.right = false;
      if (e.key === "ArrowUp" || e.key === "w") keys.up = false;
      if (e.key === "ArrowDown" || e.key === "s") keys.down = false;
    });

    canvas.addEventListener("mousemove", e => {
      const rect = canvas.getBoundingClientRect();
      const scaleX = canvas.width / rect.width;
      const scaleY = canvas.height / rect.height;
      mouse.x = (e.clientX - rect.left) * scaleX;
      mouse.y = (e.clientY - rect.top) * scaleY;
    });
    canvas.addEventListener("mousedown", () => mouse.down = true);
    window.addEventListener("mouseup", () => mouse.down = false);

    /* TOUCH JOYSTICK */
    const joy = document.getElementById("leftJoy");
    const stick = document.getElementById("leftStick");
    let joyActive = false;
    let joyX = 0, joyY = 0;

    joy.addEventListener("touchstart", e => {
      joyActive = true;
    });

    joy.addEventListener("touchmove", e => {
      const rect = joy.getBoundingClientRect();
      const touch = e.touches[0];
      const x = touch.clientX - rect.left - rect.width / 2;
      const y = touch.clientY - rect.top - rect.height / 2;

      const dist = Math.hypot(x, y);
      const max = 40;
      const clamped = Math.min(dist, max);
      const angle = Math.atan2(y, x);

      joyX = Math.cos(angle) * (clamped / max);
      joyY = Math.sin(angle) * (clamped / max);

      stick.style.left = (joyX * 40 + 32) + "px";
      stick.style.top = (joyY * 40 + 32) + "px";
    });

    joy.addEventListener("touchend", () => {
      joyActive = false;
      joyX = joyY = 0;
      stick.style.left = "32px";
      stick.style.top = "32px";
    });

    /* FIRE BUTTON */
    const fireBtn = document.getElementById("fireBtn");
    fireBtn.addEventListener("touchstart", () => mouse.down = true);
    fireBtn.addEventListener("touchend", () => mouse.down = false);

    /* GAME OBJECTS */
    const player = {
      x: canvas.width / 2,
      y: canvas.height / 2,
      r: 8,
      speed: 1.4,
      color: "#22c55e",
      fireCooldown: 0
    };

    const bullets = [];
    const enemies = [];
    let score = 0;
    let alive = true;
    let spawnTimer = 0;

    function spawnEnemy() {
      const edge = Math.floor(Math.random() * 4);
      let x, y;
      if (edge === 0) { x = 0; y = Math.random() * canvas.height; }
      else if (edge === 1) { x = canvas.width; y = Math.random() * canvas.height; }
      else if (edge === 2) { x = Math.random() * canvas.width; y = 0; }
      else { x = Math.random() * canvas.width; y = canvas.height; }

      enemies.push({
        x, y,
        r: 7,
        speed: 0.4 + Math.random() * 0.3,
        color: "#f97316"
      });
    }

    function shoot() {
      if (player.fireCooldown > 0) return;

      const dx = mouse.x - player.x;
      const dy = mouse.y - player.y;
      const len = Math.hypot(dx, dy) || 1;

      bullets.push({
        x: player.x,
        y: player.y,
        vx: (dx / len) * 3,
        vy: (dy / len) * 3,
        r: 3
      });

      player.fireCooldown = 10;
    }

    function update() {
      if (!alive) return;

      let mx = 0, my = 0;

      if (joyActive) {
        mx = joyX;
        my = joyY;
      } else {
        if (keys.left) mx -= 1;
        if (keys.right) mx += 1;
        if (keys.up) my -= 1;
        if (keys.down) my += 1;
      }

      const mag = Math.hypot(mx, my) || 1;
      mx /= mag; my /= mag;

      player.x += mx * player.speed * 2;
      player.y += my * player.speed * 2;

      player.x = Math.max(player.r, Math.min(canvas.width - player.r, player.x));
      player.y = Math.max(player.r, Math.min(canvas.height - player.r, player.y));

      if (mouse.down) shoot();
      if (player.fireCooldown > 0) player.fireCooldown--;

      for (let i = bullets.length - 1; i >= 0; i--) {
        const b = bullets[i];
        b.x += b.vx;
        b.y += b.vy;
        if (b.x < -10 || b.x > canvas.width + 10 || b.y < -10 || b.y > canvas.height + 10) {
          bullets.splice(i, 1);
        }
      }

      spawnTimer--;
      if (spawnTimer <= 0) {
        spawnEnemy();
        spawnTimer = Math.max(20, 80 - score * 2);
      }

      for (const e of enemies) {
        const dx = player.x - e.x;
        const dy = player.y - e.y;
        const len = Math.hypot(dx, dy) || 1;
        e.x += (dx / len) * e.speed;
        e.y += (dy / len) * e.speed;
      }

      for (let i = enemies.length - 1; i >= 0; i--) {
        const e = enemies[i];
        const dx = e.x - player.x;
        const dy = e.y - player.y;
        if (Math.hypot(dx, dy) < e.r + player.r) {
          alive = false;
          statusEl.textContent = "You got bonked. Refresh to try again.";
          break;
        }
      }

      for (let i = enemies.length - 1; i >= 0; i--) {
        const e = enemies[i];
        for (let j = bullets.length - 1; j >= 0; j--) {
          const b = bullets[j];
          const dx = e.x - b.x;
          const dy = e.y - b.y;
          if (Math.hypot(dx, dy) < e.r + b.r) {
            enemies.splice(i, 1);
            bullets.splice(j, 1);
            score++;
            scoreEl.textContent = "Score: " + score;
            break;
          }
        }
      }
    }

    function drawBackground() {
      const grd = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
      grd.addColorStop(0, "#020617");
      grd.addColorStop(1, "#111827");
      ctx.fillStyle = grd;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      ctx.fillStyle = "#0f172a";
      for (let i = 0; i < 30; i++) {
        const x = (i * 37) % canvas.width;
        const y = (i * 53) % canvas.height;
        ctx.fillRect(x, y, 2, 2);
      }
    }

    function drawPlayer() {
      ctx.save();
      ctx.translate(player.x, player.y);
      const angle = Math.atan2(mouse.y - player.y, mouse.x - player.x);
      ctx.rotate(angle);

      ctx.fillStyle = player.color;
      ctx.beginPath();
      ctx.arc(0, 0, player.r, 0, Math.PI * 2);
      ctx.fill();

      ctx.fillStyle = "#bbf7d0";
      ctx.fillRect(2, -2, 5, 4);

      ctx.restore();
    }

    function drawBullets() {
      ctx.fillStyle = "#38bdf8";
      for (const b of bullets) {
        ctx.beginPath();
        ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function drawEnemies() {
      for (const e of enemies) {
        ctx.fillStyle = e.color;
        ctx.beginPath();
        ctx.arc(e.x, e.y, e.r, 0, Math.PI * 2);
        ctx.fill();

        ctx.fillStyle = "#111827";
        ctx.fillRect(e.x - 3, e.y - 2, 2, 2);
        ctx.fillRect(e.x + 1, e.y - 2, 2, 2);
      }
    }

    function loop() {
      update();
      drawBackground();
      drawBullets();
      drawEnemies();
      drawPlayer();
      requestAnimationFrame(loop);
    }

    loop();
  </script>
</body>
</html>
